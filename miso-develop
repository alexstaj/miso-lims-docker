FROM miso-env
RUN     apt-get -y clean && apt-get -y install --no-install-recommends  	\
         maven git ca-certificates						&&\
	git clone https://github.com/TGAC/miso-lims.git 			&&\
	cd miso-lims 								&&\
        mvn package -P external 						&&\
	mv /miso-lims/miso-web/target/ROOT.war /var/lib/tomcat8/webapps/ 	&&\
	apt-get purge --auto-remove -q -y maven git ca-certificates 		&&\
	rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* /miso-lims

RUN	chmod 0444 /var/lib/tomcat8/webapps/ROOT.war 		&&\
	chown tomcat8 /var/lib/tomcat8/webapps/ROOT.war 	&&\
	chgrp tomcat8 /var/lib/tomcat8/webapps/ROOT.war		&&\
	rm -rf /var/lib/tomcat8/webapps/ROOT

RUN     apt-get -y update && apt-get -y install --no-install-recommends unzip xmlstarlet &&\
        cd /home/ && bash /root/miso-ansible/files/miso-install.sh 0.2.18 &&\
        apt-get purge --auto-remove -q -y unzip xmlstarlet &&\
        rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

CMD	["/root/miso-ansible/misoStart.sh"]

